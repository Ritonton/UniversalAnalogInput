<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="UniversalAnalogInputUI.Views.CurveConfigurationPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:UniversalAnalogInputUI.Controls">

    <Page.Resources>
        <!-- Number formatter for 0.000 precision -->
        <controls:DecimalNumberFormatter x:Key="DecimalFormatter" FractionDigits="3"/>
        <x:Double x:Key="CurveLayoutMinWidth">320</x:Double>
    </Page.Resources>

    <Grid Padding="15,0,15,15"
          MinWidth="{StaticResource CurveLayoutMinWidth}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="Response Curves &amp; Dead Zones" 
                   Style="{StaticResource SubtitleTextBlockStyle}" 
                   Margin="0,0,0,15"/>

        <ScrollViewer Grid.Row="1"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
            <Grid Grid.Row="1" RowSpacing="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Dead Zone Border with Overlay -->
                <Border Grid.Row="0"
                        Background="{ThemeResource SurfaceCardBackgroundBrush}"
                        CornerRadius="{ThemeResource ControlCornerRadius}">
                    <Grid>
                        <StackPanel Spacing="10" Margin="20">
                            <TextBlock Text="Dead Zone Range"
                                    FontWeight="SemiBold"/>
                            <controls:DeadZoneRangeSlider x:Name="DeadZoneSlider"
                                                    Minimum="0"
                                                    Maximum="100"
                                                    LowerValue="5"
                                                    UpperValue="95"
                                                    MinimumSeparation="5"
                                                    RangeValueChanged="DeadZoneSlider_RangeValueChanged"
                                                    HorizontalAlignment="Stretch"/>
                        <Grid ColumnSpacing="30">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Inner Dead Zone -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                <TextBlock Text="Inner:"
                                        Foreground="{ThemeResource SubtleForegroundBrush}"
                                        FontSize="12"
                                        VerticalAlignment="Center"/>
                                <Grid>
                                    <NumberBox x:Name="DeadZoneLowerInput"
                                            Value="5"
                                            Minimum="0"
                                            Maximum="100"
                                            SpinButtonPlacementMode="Compact"
                                            SmallChange="1"
                                            LargeChange="5"
                                            ValueChanged="DeadZoneLowerInput_ValueChanged"
                                            GotFocus="DeadZoneLowerInput_GotFocus"
                                            LostFocus="DeadZoneLowerInput_LostFocus"
                                            Loaded="NumberBox_Loaded"
                                            Width="65"
                                            VerticalAlignment="Center"
                                            BorderThickness="0"
                                            Padding="11,6,15,2">
                                        <ToolTipService.ToolTip>
                                            <ToolTip x:Name="DeadZoneLowerTooltip" Visibility="Collapsed">
                                                <TextBlock Text="Multiple different values selected. Click to edit."/>
                                            </ToolTip>
                                        </ToolTipService.ToolTip>
                                    </NumberBox>
                                    <TextBlock x:Name="DeadZoneLowerPercentSign"
                                            Text="%"
                                            FontSize="11"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            IsHitTestVisible="False"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Right"
                                            Margin="0,0,22,0"/>
                                </Grid>
                            </StackPanel>

                            <!-- Outer Dead Zone -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center" HorizontalAlignment="Right">
                                <TextBlock Text="Outer:"
                                        Foreground="{ThemeResource SubtleForegroundBrush}"
                                        FontSize="12"
                                        VerticalAlignment="Center"/>
                                <Grid>
                                    <NumberBox x:Name="DeadZoneUpperInput"
                                            Value="95"
                                            Minimum="0"
                                            Maximum="100"
                                            SpinButtonPlacementMode="Compact"
                                            SmallChange="1"
                                            LargeChange="5"
                                            ValueChanged="DeadZoneUpperInput_ValueChanged"
                                            GotFocus="DeadZoneUpperInput_GotFocus"
                                            LostFocus="DeadZoneUpperInput_LostFocus"
                                            Loaded="NumberBox_Loaded"
                                            Width="67"
                                            VerticalAlignment="Center"
                                            BorderThickness="0"
                                            Padding="11,6,15,2">
                                        <ToolTipService.ToolTip>
                                            <ToolTip x:Name="DeadZoneUpperTooltip" Visibility="Collapsed">
                                                <TextBlock Text="Multiple different values selected. Click to edit."/>
                                            </ToolTip>
                                        </ToolTipService.ToolTip>
                                    </NumberBox>
                                    <TextBlock x:Name="DeadZoneUpperPercentSign"
                                            Text="%"
                                            FontSize="11"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            IsHitTestVisible="False"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Right"
                                            Margin="0,0,22,0"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                        </StackPanel>

                        <!-- Overlay -->
                        <Border x:Name="DeadZoneOverlay"
                                Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}"
                                CornerRadius="{ThemeResource ControlCornerRadius}"
                                Opacity="0.85"
                                IsHitTestVisible="True"
                                Visibility="Collapsed"/>
                    </Grid>
                </Border>

                <!-- Curve Editor Border with Overlay -->
                <Border Grid.Row="1"
                        Background="{ThemeResource SurfaceCardBackgroundBrush}"
                        CornerRadius="{ThemeResource ControlCornerRadius}"
                        MinHeight="520">
                    <Grid>
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0"
                                    Text="Custom Response Curve Editor"
                                    FontWeight="SemiBold"
                                    FontSize="16"
                                    Margin="0,0,0,15"
                                    HorizontalAlignment="Center"/>

                        <Border Grid.Row="1"
                                BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                                BorderThickness="2"
                                CornerRadius="8">
                            <Grid>
                                <Canvas x:Name="GridCanvas"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        IsHitTestVisible="False"
                                        SizeChanged="GridCanvas_SizeChanged"/>

                                <Canvas x:Name="CurvePreviewCanvas"
                                        Background="Transparent"
                                        IsTabStop="True"
                                        Loaded="CurvePreviewCanvas_Loaded"
                                        PointerPressed="Canvas_PointerPressed"
                                        PointerMoved="Canvas_PointerMoved"
                                        PointerReleased="Canvas_PointerReleased"
                                        PointerExited="Canvas_PointerExited"
                                        RightTapped="Canvas_RightTapped"
                                        SizeChanged="CurvePreviewCanvas_SizeChanged"/>

                                <Grid IsHitTestVisible="False" Margin="5">
                                    <TextBlock Text="Input →"
                                            HorizontalAlignment="Right"
                                            VerticalAlignment="Bottom"
                                            FontSize="11"
                                            Foreground="{ThemeResource SubtleForegroundBrush}"
                                            Opacity="0.7"/>
                                    <TextBlock Text="↑ Output"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Top"
                                            FontSize="11"
                                            Foreground="{ThemeResource SubtleForegroundBrush}"
                                            Opacity="0.7"/>
                                </Grid>

                                <Grid x:Name="CurveCanvasOverlay"
                                      IsHitTestVisible="False"
                                      Visibility="Collapsed">
                                    <StackPanel HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Spacing="4">
                                        <TextBlock x:Name="CurveCanvasOverlayTitle"
                                                Text="Mixed"
                                                Visibility="Collapsed"
                                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                FontSize="20"
                                                FontWeight="SemiBold"
                                                HorizontalAlignment="Center"
                                                TextAlignment="Center"/>
                                        <TextBlock x:Name="CurveCanvasOverlaySubtitle"
                                                Text="Click to override to apply a shared curve."
                                                Visibility="Collapsed"
                                                Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                FontSize="14"
                                                Opacity="0.85"
                                                HorizontalAlignment="Center"
                                                TextAlignment="Center"
                                                TextWrapping="Wrap"
                                                MaxWidth="260"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>

                        <StackPanel Grid.Row="2" Margin="0,8,0,0">

                            <TextBlock Text="Smooth Curve"/>
                            <!-- Controls Row -->
                            <Grid x:Name="ControlsRowGrid"
                                ColumnSpacing="10"
                                SizeChanged="ControlsRowGrid_SizeChanged">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <ToggleSwitch Grid.Column="0"
                                            x:Name="SmoothCurveToggle"
                                            OnContent="On"
                                            OffContent="Off"
                                            Toggled="SmoothCurveToggle_Toggled"
                                            IsOn="False">
                                    <ToolTipService.ToolTip>
                                        <ToolTip x:Name="SmoothCurveMixedTooltip" Visibility="Collapsed">
                                            <TextBlock Text="Multiple mappings use different smooth settings. Toggle to apply a shared value."/>
                                        </ToolTip>
                                    </ToolTipService.ToolTip>
                                </ToggleSwitch>

                                <Grid x:Name="CoordinateInputsPanel"
                                    Grid.Column="1"
                                    ColumnSpacing="15"
                                    HorizontalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- X Coordinate -->
                                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                        <TextBlock Text="X:"
                                                Foreground="{ThemeResource SubtleForegroundBrush}"
                                                FontSize="13"
                                                VerticalAlignment="Center"/>
                                        <NumberBox x:Name="PointXInput"
                                                Value="0"
                                                Minimum="0"
                                                Maximum="1"
                                                SpinButtonPlacementMode="Compact"
                                                SmallChange="0.001"
                                                LargeChange="0.01"
                                                NumberFormatter="{StaticResource DecimalFormatter}"
                                                ValueChanged="PointXInput_ValueChanged"
                                                Loaded="NumberBox_Loaded"
                                                Width="80"
                                                VerticalAlignment="Center"
                                                BorderThickness="0"
                                                Padding="11,6,10,2"
                                                Tag="HideClearButton"
                                                IsEnabled="False"/>
                                    </StackPanel>

                                    <!-- Y Coordinate -->
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                        <TextBlock Text="Y:"
                                                Foreground="{ThemeResource SubtleForegroundBrush}"
                                                FontSize="13"
                                                VerticalAlignment="Center"/>
                                        <NumberBox x:Name="PointYInput"
                                                Value="0"
                                                Minimum="0"
                                                Maximum="1"
                                                SpinButtonPlacementMode="Compact"
                                                SmallChange="0.001"
                                                LargeChange="0.01"
                                                NumberFormatter="{StaticResource DecimalFormatter}"
                                                ValueChanged="PointYInput_ValueChanged"
                                                Loaded="NumberBox_Loaded"
                                                Width="80"
                                                VerticalAlignment="Center"
                                                BorderThickness="0"
                                                Padding="11,6,10,2"
                                                Tag="HideClearButton"
                                                IsEnabled="False"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel x:Name="ActionButtonsPanel"
                                            Grid.Column="2"
                                            Orientation="Horizontal"
                                            Spacing="8"
                                            HorizontalAlignment="Right">
                                    <Button x:Name="RemovePointButton"
                                            Click="RemovePointButton_Click"
                                            IsEnabled="False"
                                            VerticalAlignment="Bottom"
                                            Width="40"
                                            Height="40"
                                            Padding="0"
                                            ToolTipService.ToolTip="Remove Selected Point">
                                        <FontIcon Glyph="&#xE74D;" FontSize="16"/>
                                    </Button>
                                    <Button x:Name="ResetCurveButton"
                                            Click="ResetCurveButton_Click"
                                            VerticalAlignment="Bottom"
                                            Width="40"
                                            Height="40"
                                            Padding="0"
                                            ToolTipService.ToolTip="Reset to Linear">
                                        <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                                    </Button>
                                </StackPanel>
                            </Grid>

                            <!-- Help Text Row -->
                            <TextBlock Text="Left-click: Add point • Drag: Move point • Right-click: Delete point"
                                    HorizontalAlignment="Center"
                                    Foreground="{ThemeResource SubtleForegroundBrush}"
                                    FontSize="12"
                                    Margin="0,15,0,0"/>
                        </StackPanel>
                        </Grid>

                        <!-- Overlay -->
                        <Border x:Name="CurveEditorOverlay"
                                Grid.Row="0"
                                Grid.RowSpan="3"
                                Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}"
                                CornerRadius="{ThemeResource ControlCornerRadius}"
                                Opacity="0.85"
                                IsHitTestVisible="True"
                                Visibility="Collapsed"/>
                    </Grid>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
